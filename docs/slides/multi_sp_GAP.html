<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Modelos de ocupaci칩n multi-especie</title>
    <meta charset="utf-8" />
    <meta name="author" content="Gabriel Andrade Ponce" />
    <meta name="date" content="2022-04-25" />
    <script src="multi_sp_GAP_files/header-attrs/header-attrs.js"></script>
    <script src="multi_sp_GAP_files/clipboard/clipboard.min.js"></script>
    <link href="multi_sp_GAP_files/shareon/shareon.min.css" rel="stylesheet" />
    <script src="multi_sp_GAP_files/shareon/shareon.min.js"></script>
    <link href="multi_sp_GAP_files/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="multi_sp_GAP_files/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="multi_sp_GAP_files/tile-view/tile-view.css" rel="stylesheet" />
    <script src="multi_sp_GAP_files/tile-view/tile-view.js"></script>
    <script src="multi_sp_GAP_files/htmlwidgets/htmlwidgets.js"></script>
    <link href="multi_sp_GAP_files/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="multi_sp_GAP_files/datatables-binding/datatables.js"></script>
    <script src="multi_sp_GAP_files/jquery/jquery-3.6.0.min.js"></script>
    <link href="multi_sp_GAP_files/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="multi_sp_GAP_files/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="multi_sp_GAP_files/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="multi_sp_GAP_files/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="multi_sp_GAP_files/crosstalk/js/crosstalk.min.js"></script>
    <link href="multi_sp_GAP_files/countdown/countdown.css" rel="stylesheet" />
    <script src="multi_sp_GAP_files/countdown/countdown.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






class: center, top, inverse
background-image: url("img/coati.jpg")
background-position: 60% 60%
background-size: cover

# Modelos de ocupaci칩n multi-especie
# &amp;#x1F9A8;&amp;#x1F9A5; Modelos de comunidad &amp;#x1F99D;&amp;#x1F98C;


---

name: hola
class: center, middle

## Gabriel Andrade Ponce 游뻟릖

&lt;img style="border-radius: 50%;" src="img/Jost_Collwell_me.jpeg"
width="300px height= 300px"
/&gt;

### Estudiante de Doctorado
.fade[Instituto de Ecolog칤a A.C, Xalapa, Ver., Mex]


[&lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"&gt;&lt;/path&gt;&lt;/svg&gt;@Gatorco_AP](https://twitter.com/Gatorco_AP)
[&lt;svg viewBox="0 0 496 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"&gt;&lt;/path&gt;&lt;/svg&gt;@gpandradep](https://github.com/gpandradep)
&lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"&gt;&lt;/path&gt;&lt;/svg&gt; gpandradep@gmail.com
---
class: center

# En este taller vamos a ver dos aproximaciones

## 1. Modelar la "abundancia" con modelos jer치rquicos

Predecimos las "abundancias" o intensidad de las especies para usarlas como insumo en los c치lculos de diversidad

## 2.1 Usamos modelos jer치rquicos para estimar riqueza

Usamos directamente una proximaci칩n jer치rquica para estimar la riqueza de especies de una localidad

---
name: det1

# La detecci칩n imperfecta

Es cuando la probabilidad de detectar una especie dado que est칠 presente en nuestro sitio sea menor a 1
.pull-left[
![](img/det1.png)
]
.pull-right[
![](img/det2.png)
]
---
class: midle
# La detecci칩n imperfecta

.pull-left[
&lt;img src= https://zslpublications.onlinelibrary.wiley.com/cms/asset/1875594b-72d8-4b0d-bad4-b0ab9d5c7805/jzo12828-fig-0003-m.jpg width= "70%"&gt;

.footnote[Tourani, M., Br칮ste, E.N., Bakken, S., Odden, J. and Bischof, R. (2020), Sooner, closer, or longer: detectability of mesocarnivores at camera traps. J Zool, 312: 259-270. https://doi.org/10.1111/jzo.12828]
]

.pull-right[
Cada especie tiene su propia probabilidad de ser detectada y puede depender de:

- El tama침o
- La velocidad de paso
- La distancia a la c치mara
- El tiempo de muestreo
- Abundancia
- Entre otros....
&lt;br&gt;]

---
class: center, middle
## Modelos de jer치rquicos al rescate

Son dos o m치s modelos probabil칤sticos, condicionados por las variables de probabilidad que describen. &lt;br&gt;

![](img/guillera2017.jpg)
---
class: center
### La funci칩n que vamos a utilizar usa como base el modelo Royle-Nichols [(Royle &amp; Nichols 2003)](https://esajournals.onlinelibrary.wiley.com/doi/10.1890/0012-9658%282003%29084%5B0777%3AEAFRPA%5D2.0.CO%3B2)

.pull-left[
# Ecol칩gico

Describe la variable de estado ecol칩gica de inter칠s
&lt;br&gt;

En este caso describe la abundancia 

$$N\sim Poisson (\lambda) $$
]

.pull-right[
# Observacional

Describe el proceso mediante el cual se toman los datos

$$ p= 1- (1-r)^N  $$

$$ y \sim Bernoulli (p)$$

]
---
class: inverse, middle, center
background-image: url("img/biodiv.jpg")
background-position: center
background-size: cover

# .big-text[ Diversidad con modelos jer치rquicos]
---
## Script `DivOC_script.R`
### Comenzaremos usando la paqueter칤a `DiversityOccupancy`

Este paquete estima la diversidad alfa por medio de modelos jer치rquicos. 



```r
# 1. Instalar y cargar el paquete ----

# install.packages("DiversityOccupancy")

library(DiversityOccupancy)
library(camtrapR)
library(tidyverse)
library(hillR) # Estimar diversidad
library(ggeffects) #gr치ficas de pred para glm
library(beepr) # Opcional para avisar R termine
library(tictoc) # Opcional para tomar el tiempo de la funci칩n
```

Este paquete te va a pedir instalar tambi칠n `MuMIn`, `unmarked`, `reshape`, `lattice`, `Rcpp`
---
## Formato de los datos

Son necesarios eventos de muestreo repetidos. 
&lt;br&gt;

Vamos a trabajar con una base de datos de 17 especies, 67 sitios (c치maras) y 16 eventos de muestreo.

&gt; **Nota**: Todas las especies deben tener una matriz de historias de detecci칩n de las mismas dimensiones


```r
# Cargamos la tabla de registros de las especies
registers &lt;-  read.csv("Data/Survey/recordTable_OC.csv")
table(registers$Species)
```

```
## 
##      Bassariscus astutus            Canis latrans   Canis lupus familiaris 
##                        3                        6                        4 
##             Capra hircus     Conepatus leuconotus     Dasypus novemcinctus 
##                       13                       79                        1 
##               Lynx rufus        Mephitis macroura             Nasua narica 
##                       50                       18                        4 
##   Odocoileus virginianus            Pecari tajacu            Procyon lotor 
##                      227                       71                       40 
##        Puma yagouaroundi                 Roedores   Spilogale angustigrons 
##                        6                       66                       13 
##    Sylvilagus floridanus Urocyon cinereoargenteus 
##                      492                      173
```

```r
# Cargamos la tabla de operaci칩n de c치maras
CToperation &lt;-  read.csv("Data/Survey/CTtable_OC.csv") 

# Generamos la matr칤z de operaci칩n de las c치maras

camop &lt;- cameraOperation(CTtable= CToperation, # Tabla de operaci칩n
                         stationCol= "Station", # Columna que define la estaci칩n
                         setupCol= "Setup_date", #Columna fecha de colocaci칩n
                         retrievalCol= "Retrieval_date", #Columna fecha de retiro
                         hasProblems= T, # Hubo fallos de c치maras
                         dateFormat= "%Y-%m-%d") # Formato de las fechas
```

---

```r
# Funci칩n para generar las historias de detecci칩n para todas las especies seleccionadas

DetHist_list &lt;- lapply(unique(registers$Species), FUN = function(x) {
  detectionHistory(
    recordTable         = registers, # Tabla de registros
    camOp                = camop, # Matriz de operaci칩n de c치maras
    stationCol           = "Station",
    speciesCol           = "Species",
    recordDateTimeCol    = "DateTimeOriginal",
    recordDateTimeFormat  = "%d/%m/%Y",
    species              = x,     # la funci칩n reemplaza x por cada una de las especies
    occasionLength       = 10,  # Colapso de las historias a 10 d칤as
    day1                 = "station", #inicie en la fecha de cada estaci칩n
    datesAsOccasionNames = FALSE,
    includeEffort        = TRUE,
    scaleEffort          = TRUE,
    timeZone             = "America/Mexico_City" 
  )}
)

# Se genera una lista con cada historia de detecci칩n y el esfuerzo de muestreo, ahora le colocaremos los nombres para saber a cual especie corresponde
names(DetHist_list) &lt;- unique(registers$Species)

# Finalmente creamos una lista nueva donde est칠n solo las historias de detecci칩n
ylist &lt;- lapply(DetHist_list, FUN = function(x) x$detection_history)

# Todas las historias deben tener el mismo n칰mero de sitios y de ocasiones de muestreo

data &lt;- ylist %&gt;% # Lista con los datos
  reduce(cbind) # Unimos las historias de captura en un solo dataframe
```



---
.center[## Formato de los datos]

Obtenemos una matriz con el mismo n칰mero de sitios **67** y *19* eventos X *19* especies = 323 columnas 

<div id="htmlwidget-a7867f518834352b67d5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a7867f518834352b67d5">{"x":{"filter":"none","vertical":false,"data":[["C1T2P1","C1T2P11","C1T2P21","C1T4P1","C1T4P11","C1T4P21"],[0,null,0,0,1,0],[0,null,0,0,0,0],[0,null,0,0,1,0],[0,1,0,0,0,0],[0,0,0,0,0,0],[0,1,0,0,0,0],[1,0,0,0,1,0],[0,1,0,0,1,0],[0,0,1,0,1,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[1,0,0,0,0,0],[1,0,0,0,0,0],[1,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,1,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[1,null,0,0,1,0],[1,null,0,0,1,0],[1,null,0,0,1,0],[1,1,0,0,1,0],[1,0,0,0,1,0],[1,1,1,0,1,0],[1,1,1,0,1,0],[1,1,1,0,1,0],[1,1,1,0,1,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[1,null,0,0,1,0],[0,null,0,0,1,0],[0,null,0,0,1,0],[0,0,0,0,1,0],[0,0,0,0,1,0],[0,1,1,0,0,0],[1,1,1,0,1,0],[0,0,0,0,1,0],[1,1,1,0,1,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,1,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,1,0,0,0,0],[0,0,0,0,0,0],[0,0,1,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,1,0,1,0],[0,null,1,0,1,0],[0,null,1,1,1,0],[0,0,0,0,1,0],[0,0,1,0,0,0],[0,0,0,0,1,0],[0,1,0,0,0,0],[0,0,1,0,1,0],[0,1,1,0,1,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,1,0,0,0],[0,0,0,0,1,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,1,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,1,0],[0,null,0,0,0,0],[0,null,0,0,1,0],[0,0,0,0,1,0],[0,0,0,0,0,0],[0,0,0,0,1,0],[0,0,0,0,1,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,null,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n      <th>o1<\/th>\n      <th>o2<\/th>\n      <th>o3<\/th>\n      <th>o4<\/th>\n      <th>o5<\/th>\n      <th>o6<\/th>\n      <th>o7<\/th>\n      <th>o8<\/th>\n      <th>o9<\/th>\n      <th>o10<\/th>\n      <th>o11<\/th>\n      <th>o12<\/th>\n      <th>o13<\/th>\n      <th>o14<\/th>\n      <th>o15<\/th>\n      <th>o16<\/th>\n      <th>o17<\/th>\n      <th>o18<\/th>\n      <th>o19<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
---
# Cargar las covariables
Vamos a leer el archivo .csv de la ruta `data/Covs/` que contiene las covariables de sitio (no usaremos de observaci칩n). Todas estas estandarizadas



```r
# Ahora cargamos las covariables (previamente estandarizadas)
covars &lt;- read.csv("Data/Covs/stdcovs_OC.csv") %&gt;% 
  select(-"...1", -X, -Station, -Cam, -Cluster) # Las gr치ficas no funcionan con categ칩ricas
```



&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; Vertcover_50 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Dcrops &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; MSAVI &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Slope &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Effort &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Dpop_G &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; -0.4744602 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6765368 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7316819 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.2195550 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.2080680 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.4260974 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 0.6519157 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4620448 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.8666152 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.9927301 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.4605398 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.3167450 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; -0.9243340 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.2193059 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.5838870 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.0258694 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.0719298 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.1805434 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; -0.9243340 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.4603495 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.1430110 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4183658 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.8887592 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.1922714 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



&gt; **Importante**: Cada proceso es afectado por diferentes covariables. Para m치s informaci칩n mira este **[enlace](https://mmeredith.net/blog/2021/Polar_bear.htm?fbclid=IwAR2XKX0X9Lu-Bqu2skniXNJV54dsMqy0lb7AdFZpoCR4ZN1E5Yt71rLvgF4)**

---
# Manos a la obra

### Vamos a utilizar la funci칩n `diversityoccu()`

Se genera un objeto lista con los modelos para cada una de las especies, c치lculo de diversidad y otras cosas....


```r
cam_diver &lt;- diversityoccu(pres = data, # La matriz de datos
     sitecov = covars, # Covariables de sitio
     obscov = NULL, # no tenemos covariables de observaci칩n,
     spp = 16, # N칰mero de especies
     form = ~ Effort + Slope ~ Dcrops, # Formula del modelo p(), lambda()
     dredge = FALSE # En este primer ejemplo no usaremos AIC
     )
```

```
## [1] "Species 1 ready!"
## [1] "Species 2 ready!"
## [1] "Species 3 ready!"
## [1] "Species 4 ready!"
## [1] "Species 5 ready!"
## [1] "Species 6 ready!"
## [1] "Species 7 ready!"
## [1] "Species 8 ready!"
## [1] "Species 9 ready!"
## [1] "Species 10 ready!"
## [1] "Species 11 ready!"
## [1] "Species 12 ready!"
## [1] "Species 13 ready!"
## [1] "Species 14 ready!"
## [1] "Species 15 ready!"
## [1] "Species 16 ready!"
```

Se va a generar un objeto lista con los modelos para cada una de las especies, c치lculo de diversidad y otras cosas....
---
### Veamos uno de los modelos &amp;#x1F43A;


```r
cam_diver$models[[9]] # Modelo para la especie 9 
```

```
## 
## Call:
## occuRN(formula = form, data = data2)
## 
## Abundance:
##             Estimate    SE     z  P(&gt;|z|)
## (Intercept)   -1.643 0.322 -5.11 3.25e-07
## Dcrops        -0.483 0.311 -1.55 1.20e-01
## 
## Detection:
##             Estimate    SE      z P(&gt;|z|)
## (Intercept)   -0.540 0.376 -1.436 0.15091
## Effort        -1.919 0.576 -3.333 0.00086
## Slope          0.138 0.301  0.458 0.64725
## 
## AIC: 190.8491
```

---
class: inverse, center
# El problema.....

No sabemos si todas las especies responden de la misma manera a las covariables que usamos. Debemos escoger de todas las variables cual se ajusta mejor a cada especie

.pull-left[

### 쮺칩mo vamos a generar todas las posibles combinaciones de modelos para cada especie?
]
--
.pull-right[
![](https://blogs.unitec.mx/content/dam/blogs/imagenes/corp_samara/por-que-es-tan-dificil-quedarte-en-tu-primera-opcion-7.gif)
 Tranquilo esta misma funci칩n lo hace por ti :D
]
---
## Solamente tenemos que activar `dredge`

Dependiendo de tu computador la funci칩n puede tardar m치s o menos. En la m칤a dur칩 ~57 segs.
Pero puede tardar mucho m치s dependiendo del n칰mero de especies, sitios, eventos de muestreo y cantidad de covariables.


```r
cam_diver_AIC &lt;- diversityoccu(pres = data, # La matriz de datos
                           sitecov = covars, # Covariables de sitio
                           obscov = NULL, # no tenemos covariables de observaci칩n,
                           spp = 17, # N칰mero de especies
                           form = ~ Effort + Slope ~ Dcrops, # Formula del modelo p(), lambda()
                           dredge = TRUE # escoge los mejores modelos con AIC
)
```


---
class: center
## Veamos de nuevo el modelo que seleccion칩 para la sp9 &amp;#x1F43A;
.pull-left[

```r
cam_diver$models[[9]]
```

```
## 
## Call:
## occuRN(formula = form, data = data2)
## 
## Abundance:
##             Estimate    SE     z  P(&gt;|z|)
## (Intercept)   -1.643 0.322 -5.11 3.25e-07
## Dcrops        -0.483 0.311 -1.55 1.20e-01
## 
## Detection:
##             Estimate    SE      z P(&gt;|z|)
## (Intercept)   -0.540 0.376 -1.436 0.15091
## Effort        -1.919 0.576 -3.333 0.00086
## Slope          0.138 0.301  0.458 0.64725
## 
## AIC: 190.8491
```
]

.pull-right[

```r
cam_diver_AIC$models[[9]]
```

```
## 
## Call:
## occuRN(formula = ~Effort + Slope + 1 ~ 1, data = data2)
## 
## Abundance:
##  Estimate    SE      z P(&gt;|z|)
##    -0.145 0.272 -0.532   0.595
## 
## Detection:
##             Estimate    SE     z  P(&gt;|z|)
## (Intercept)   -2.846 0.333 -8.54 1.30e-17
## Effort         0.925 0.308  3.01 2.62e-03
## Slope         -0.596 0.215 -2.77 5.58e-03
## 
## AIC: 315.6987
```
]
---
class: center
### Veamos el resultado gr치fico para la especie 3 &amp;#128023;


```r
(responseplot.abund( batch = cam_diver_AIC, # objeto creado con diversityoccu
                    spp = 3, # n칰mero o nombre de la sp
                    variable= Dcrops # variable  
))
```

&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-13-1.png" width="100%" /&gt;

---
class: center
# Momento de la diversidad

Tenemos un modelo donde se estima la abundancia para cada especie, es hora de modelar la diversidad


```r
glm.div &lt;- model.diversity(DivOcc = cam_diver_AIC,# modelos
                           method = "h", # m칠todo
                           delta = 2, 
                           squared = T # t칠rminos cuadr치ticos
                                                     )
```



---
class: center
# Momento de la diversidad


```r
AICtab &lt;- glm.div$Table
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; model &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; aicc &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; weights &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Delta.AICc &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Diversity ~ 1 + Dcrops + I(Dcrops^2) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -331.8899 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.3229081 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0000000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Diversity ~ 1 + Vertcover_50 + Dcrops + I(Dcrops^2) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -331.3285 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2438852 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5613404 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Diversity ~ 1 + Dcrops + MSAVI + I(Dcrops^2) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -330.5617 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1662141 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.3281821 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Diversity ~ 1 + Dcrops + MSAVI + I(Dcrops^2) + I(MSAVI^2) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -330.3166 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1470432 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.5732824 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Diversity ~ 1 + Dcrops + Dpop_G + I(Dcrops^2) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -329.9093 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1199495 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.9805941 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
### Ahora veamos la respuesta gr치fica de la diversidad a una variable

```r
responseplot.diver(glm.div, Dcrops)
```

&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-18-1.png" width="100%" /&gt;
A medida que aumenta el valor de distancia a cultivos (escalado) hay mayor diversidad ?????

---
class: inverse, center, middle

# Relativamente f치cil
![](https://ugc.kn3.net/i/760x/https://media1.tenor.com/images/048cc35b45c1545328f41a03d0177ffa/tenor.gif?itemid=5513707)

# Para ser verdad .....
---
# Diversidad....

Si seguimos la vi침eta del paquete nunca nos dice que elemento de la diversidad mide o calcula..

- Riqueza?
- Shannon, simpson?....
- N칰mero efectivo de especies?? (Hill)
--

# Glm? de que tipo?
Un Glm puede ser de varias familias (distribuciones) y depende de la naturaleza de los datos: conteos, proporciones, unos y ceros

---
class: center
# Es importante leer el manual
.pull-left[
![](https://i.gifer.com/7hRo.gif)
]
.pull-right[
 Hay otro argumento de la funci칩n `diversityoccu` y es *"index"*. Este argumento permite escoger que 칤ndice utilizar **"shannon"**, **"simpson"** o **"invsimpson"**.


```r
cam_diver_sh &lt;- diversityoccu(pres = data, 
                           sitecov = covars, 
                           obscov = NULL, 
                           spp = 17, 
                           form = ~ Effort + Slope ~ Dcrops,
                           dredge = TRUE, 
*                          index = "shannon"
)
```

]

---
## Podemos aplicar la funci칩n para cada 칤ndice...?
&gt; Tambi칠n se puede hacer una funci칩n que lo haga en autom치tico, pero por simplicidad (~~no se hacerlo bien~~) corremos tres veces la funci칩n



```r
cam_diver_sim &lt;- diversityoccu(pres = data, 
                           sitecov = covars, 
                           obscov = NULL, 
                           spp = 17, 
                           form = ~ Effort + Slope ~ Dcrops,                            dredge = TRUE,  
*                          index = "simpson"
)

cam_diver_inv &lt;- diversityoccu(pres = data, 
                           sitecov = covars, 
                           obscov = NULL, 
                           spp = 17, 
                           form = ~ Effort + Slope ~ Dcrops,                            dredge = TRUE,  
*                          index = "invsimpson"
)
```



---
# 칈ndices de entrop칤a .....

El problema de estos 칤ndices (~~para los ec칩logos~~) es que
- son adimensionales
- no siguen una relaci칩n lineal con la riqueza (doble de riqueza `\(\neq\)` doble de diversidad)

![](img/jost2006.png)

---

### Calculemos el n칰mero efectivo de especies con las abundancias estimadas

```r
# Extraer los datos de abundancia
hill_data &lt;- cam_diver_inv[[4]] %&gt;% 
  select(-h)
```

Sospechoso...

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; species.1 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.2 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.3 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.4 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.5 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.6 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.7 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.8 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.9 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.10 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.11 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.12 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.13 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.14 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.15 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.16 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; species.17 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 0.6082829 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.179013 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.9865411 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7986634 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6344777 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.470707 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.73449 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.942110 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8654214 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1201388 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.197757 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1485776 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.906907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0098931 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.119418 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.43433 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2379503 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 0.6082829 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.179013 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.2351996 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7986634 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6344777 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.470707 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.73449 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6.441039 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8654214 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1201388 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.197757 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1485776 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.906907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0014365 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.119418 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.43433 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2379503 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 0.6082829 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.179013 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.5340820 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7986634 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6344777 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.470707 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.73449 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13.709316 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8654214 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1201388 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.197757 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1485776 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.906907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0002236 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.119418 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.43433 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2379503 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 0.6082829 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.179013 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.9273586 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7986634 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6344777 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.470707 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.73449 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.371387 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8654214 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1201388 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.197757 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1485776 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.906907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0168258 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.119418 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.43433 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2379503 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 0.6082829 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.179013 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.1369200 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7986634 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6344777 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.470707 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.73449 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.824359 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8654214 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1201388 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.197757 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1485776 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.906907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0029269 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.119418 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.43433 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2379503 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 0.6082829 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.179013 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4022314 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7986634 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6344777 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.470707 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.73449 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.022276 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8654214 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1201388 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.197757 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1485776 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.906907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0004836 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.119418 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.43433 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2379503 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---
# Calculemos diversidad con `hillR`


```r
# calcular los perfiles de diversidad
q0 &lt;- hill_taxa(hill_data, q=0) 
q1 &lt;- hill_taxa(hill_data, q=1)
q2 &lt;- hill_taxa(hill_data, q=2)
```

Ahora unimos las bases de datos y las covariables para modelar


```r
# Unir las bases de perfiles de diversidad
hill_div &lt;- data.frame(q0=q0, q1=q1, q2=q2)
# Unir con las covariables
glm_hill &lt;- cbind(hill_div, covars)
```

---
# Obtenemos esta base

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; q0 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; q1 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; q2 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Vertcover_50 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Dcrops &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; MSAVI &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Slope &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Effort &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Dpop_G &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.289319 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.282369 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.4744602 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6765368 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7316819 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.2195550 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.2080680 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.4260974 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.475290 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.686556 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6519157 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4620448 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.8666152 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.9927301 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.4605398 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.3167450 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.067675 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.417599 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.9243340 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.2193059 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.5838870 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.0258694 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.0719298 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.1805434 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.202937 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.171999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.9243340 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.4603495 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.1430110 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4183658 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.8887592 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.1922714 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.447582 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.557032 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.1509622 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.1723154 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2129457 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.0597006 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.0719298 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.0948151 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.341428 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.685354 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6519157 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.9052628 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5284530 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.0258694 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.0719298 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0268169 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
# Ahora ajustemos un glm sencillo


```r
glm_q1 &lt;- glm(q1~ Dcrops, family = gaussian, data = glm_hill)
```

y usemos ggeffects para graficar

.pull-left[

```r
plot_q1 &lt;- ggpredict(glm_q1, terms = "Dpop_G")
plot(plot_q1)+
  labs(y= "Diversidad q1", 
       x= "Distancia a poblados (estandarizado)")+
  theme_classic()
```
]

.pull-right[
&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-29-1.png" width="100%" /&gt;
]
---
class: center

# Tarea
- Modelar los otros perfiles de diversidad
- Crear modelos candidatos con otras covariables y escoger con AIC

![](https://www.recreoviral.com/wp-content/uploads/2016/04/Las-tareas-est%C3%A1n-destruyendo-a-nuestros-hijos-y-los-cient%C3%ADficos-piden-prohibirla-4.gif)
---

.pull-left[
# Consideraciones finales

1. El paquete es bueno y agiliza muchos pasos del modelado

2. Cuando no hay ninguna covariable que explique la abundancia, se asume que es constante para todos los sitios. Eso puede subestimar o sobrestimar la abundancia...

3. Abundancia constante: diversidad de la localidad y no de la c치mara?

4. Si se usan los 칤ndices de entrop칤a se debe saber c칩mo interpretarlos ([Jost 2006](https://onlinelibrary.wiley.com/doi/abs/10.1111/j.2006.0030-1299.14714.x) ; [Jost et al 2010](https://onlinelibrary.wiley.com/doi/full/10.1111/j.1472-4642.2009.00626.x))]

.pull-right[
&lt;img src="https://compote.slate.com/images/18065fdf-67ca-448a-9ebd-6236a7dac8e8.jpg" /&gt;
]

---
## Un ejemplo de c칩mo se pueden usar los modelos Royle-Nichols para calcular diversidad
.pull-left[
&gt; Tesis de pregrado premiada por la AMMAC

https://www.youtube.com/watch?v=qaD9NRAg3SQ ]

.pull-right[

&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/qaD9NRAg3SQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt;]
---

class: inverse, center, middle

&lt;img src="https://pa1.narvii.com/6159/c7f0dd0c6a7a81293a754044edc52cd4ee80e310_hq.gif" width="50%" align="right" /&gt;

.pull-left[
# Descanso para un cafecito
<div class="countdown" id="timer_62674be5" style="right:0;bottom:0;left:0;margin:5%;padding:50px;font-size:6em;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
]

---
class: inverse, center


# Otra opci칩n elegante
.pull-left[
&lt;br&gt;
### Es posible estimar la riqueza de especies directamente de un modelo jer치rquico
Es mejor modelar directamente la variaci칩n espacial de la riqueza mientras se considera la detecci칩n, eliminando as칤 varias etapas de an치lisis
]

.pull-right[
![](img/memediv.jpg)
]

---
# Modelo de comunidad Dorazio &amp; Royle (2005)

Es una extensi칩n del modelo de una especie y una temporada en donde se combinan las historias de detecci칩n de todas las especies encontradas en los sitios de muestreo
![](img/multi.png)

---
class: center
# 쮺칩mo funciona?

.pull-left[
![](img/M-N.png)
]

.pull-right[
&lt;br&gt;
&lt;br&gt;
Para entender el modelo tenemos que imaginar una comunidad con **N** especies. Al realizar un muestreo encontramos **n** especies. C칩mo no sabemos que porcentaje de **n** representa **N**, debemos asumir una comunidad **M** lo suficientemente grande para contener a **N**.]
---
# El aumentado de datos &amp;#x1fa84;

.pull-left[
Es un concepto utilizado bajo el enfoque bayesiano y consiste en agregar un n칰mero arbitrario de especies potenciales a la muestra de modo que `\(M&gt;N\)`.
&lt;br&gt;
&lt;br&gt;
Este n칰mero se define como `\(nz= M-n\)`, donde **n** es el n칰mero de especies observado y **nz** es el n칰mero de especies potenciales adicionadas.
]

.pull-right[
&lt;br&gt;

![](https://i.pinimg.com/236x/09/1b/50/091b50565f23ae2be2c4c2b533d1bd33--ugly-americans-nerd.jpg)
]

---

# Este modelo tiene tres niveles o procesos

### 1. Primern nivel o super par치metro
El par치metro aumentado describe la probabilidad de que la especie "real" **k** pertenezca a **N**, dado el total de especies potenciales de **M**
$$ \omega{_k} \sim Bernoulli(\Omega) $$
--
Donde `\(\Omega\)` es la probabilidad de que la especie **k** pertenezca a la meta-comunidad de tama침o (desconocido) **N**. En ese sentido `\(N=M\Omega\)`, por lo cual al estimar `\(\Omega\)` conoceremos **N**. Esto es posible ya que conocemos **M**.
---

### 2. Segundo nivel o proceso ecol칩gico

Describe la ocupaci칩n de las especies en cada sitio *i* siguiendo una distribuci칩n *Bernoulli*
`$$z_{ik}|w_k\sim Bernoulli(\psi_{k}\omega_k)$$`
--
Donde `\(z_{k}\)` son elementos de la matriz de ocupaci칩n real y `\(\psi_{k}\)` es la probabilidad de ocupaci칩n de cada especie en cada sitio de muestreo dado que este presente en la comunidad.

--
### 3. Tercer nivel o proceso observacional

El proceso de detecci칩n o log칤stico es similar al del modelo de ocupaci칩n b치sico. Puede ser *Binomial* o *Bernoulli* dependiendo del formato de los datos

`$$ysum_{ik}|z_{ik}\sim Binomial(J_i,p_{k}z_{ik})$$`
--
Donde `\(ysum_{ik}\)` indica la detecci칩n o no detecci칩n de una especie **k** en el sitio **i** en **J** n칰mero de eventos para cada sitio, con una probabilidad de `\(p_{k}\)`
---
# El modelo asume heterogeneidad en  psi y p

El modelo asume a cada especie como un **efecto aleatorio**. Es decir, que todas provienen de una misma distribuci칩n y son similares pero no iguales. 

Este supuesto hace que  especies con menos datos no difumine la informaci칩n de la comunidad. Lo que proporciona mayor precisi칩n y habilidad de predicci칩n al par치metro aumentado.
En t칠rminos de probabilidad los efectos aleatorios se define as칤 para la ocupaci칩n
`$$logit(\psi_k)\sim Normal(\mu_{lpsi},\sigma^2_{lpsi})$$`

Y as칤 para la detecci칩n


`$$logit(p_k)\sim Normal(\mu_{lp},\sigma^2_{lp})$$`
Donde `\(\mu\)` y `\(\sigma\)` son los par치metros de una distribuci칩n normal

---
# 쮺칩mo se estiman las especies faltantes?

El modelo usa la informaci칩n de las especies presentes para estimar las especies sin datos.
As칤 la probabilidad de no encontrar una especie **k** es:

`$$m_k=[1-\psi_{ik}[1-(1-p_k)^J]]^S$$`

---
class: center
### 쮺칩mo se estiman las especies faltantes?

A medida que tenemos menor `\(\psi_k\)` o `\(p_k\)` pues `\(N&gt;n\)`

&lt;img src="img/mk.png" width="1200" height= "400" /&gt;

---
# Manos a la obra
### Script `multioccu_script.R`

Recuerden instalar la versi칩n de desarrollo de camtrapR


```r
remotes::install_github("jniedballa/camtrapR")
```

 Lo primero es cargar todas las librerias necesarias.
&gt; Recuerden que para instalar rjags necesitan instalar en su maquina el programa [JAGS](https://sourceforge.net/projects/mcmc-jags/files/)


```r
library(camtrapR) # Datos de c치maras y modelos
library(rjags) # Para correr el modelo
library(SpadeR) # Riqueza Chao2
library(tidyverse) # Manipular datos
library(nimble) # LEnguaje BUGS
library(nimbleEcology) # Nimble enfocado en jer치rquicos
library(bayesplot) # gr치ficos estimaciones bayesianas
library(SpadeR) # Riqueza Chao2
library(beepr) # Opcional para avisar R termine
library(tictoc) # Opcional para tomar el tiempo de la funci칩n
library(extrafont) #opcional para cambiar la fuente
library(snowfall)
```
---
# Formato de los datos

Vamos a usar los mismos datos que del ejemplo anterior. Seguimos un procedimiento similar para cargar los datos.




```r
# Cargamos la tabla de registros de las especies
registers &lt;-  read.csv("Data/Survey/recordTable_OC.csv")

# Cargamos la tabla de operaci칩n de c치maras
CToperation &lt;-  read.csv("Data/Survey/CTtable_OC.csv") 

# Generamos la matr칤z de operaci칩n de las c치maras

camop &lt;- cameraOperation(CTtable= CToperation, # Tabla de operaci칩n
                         stationCol= "Station", # Columna que define la estaci칩n
                         setupCol= "Setup_date", #Columna fecha de colocaci칩n
                         retrievalCol= "Retrieval_date", #Columna fecha de retiro
                         hasProblems= T, # Hubo fallos de c치maras
                         dateFormat= "%Y-%m-%d") # Formato de las fechas
```
---

```r
# Funci칩n para generar las historias de detecci칩n para todas las especies seleccionadas

DetHist_list &lt;- lapply(unique(registers$Species), FUN = function(x) {
  detectionHistory(
    recordTable         = registers, # Tabla de registros
    camOp                = camop, # Matriz de operaci칩n de c치maras
    stationCol           = "Station",
    speciesCol           = "Species",
    recordDateTimeCol    = "DateTimeOriginal",
    recordDateTimeFormat  = "%d/%m/%Y",
    species              = x,     # la funci칩n reemplaza x por cada una de las especies
    occasionLength       = 10, # Colapso de las historias a 10 칤as
    day1                 = "station", #inicie en la fecha de cada estaci칩n
    datesAsOccasionNames = FALSE,
    includeEffort        = TRUE,
    scaleEffort          = TRUE,
    timeZone             = "America/Mexico_City" 
  )}
)

# Se genera una lista con cada historia de detecci칩n y el esfuerzo de muestreo, ahora le colocaremos los nombres para saber a cual especie corresponde
names(DetHist_list) &lt;- unique(registers$Species)

# Finalmente creamos una lista nueva donde est칠n solo las historias de detecci칩n
ylist &lt;- lapply(DetHist_list, FUN = function(x) x$detection_history)
```

Terminatemos con el objeto ylist que tonciente todas las historias de detecci칩n

---

### Finalmente las covariables


```r
## Covariables 

#Cargamos la base de covariables
covars &lt;- read.csv("Data/Covs/stdcovs_OC.csv")

identical(nrow(ylist[[1]]), nrow(covars)) # Verificar que tengan el mismo n칰mero de filas
```

```
## [1] TRUE
```


---
## Finalmente unimos todo en un objeto lista con los datos que requiere el modelo


```r
# Generamos la base de datos para el modelo
data_list &lt;- list(ylist    = ylist, # Historias de detecci칩n
                  siteCovs = covars, # Covariables de sitio
                  obsCovs  = list(effort = DetHist_list[[1]]$effort))  # agregamos el esfuerzo de muestreo como covariable de observaci칩n

str(data_list)
```

```
## List of 3
##  $ ylist   :List of 17
##   ..$ Conepatus leuconotus    : num [1:67, 1:19] 0 NA 0 0 1 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Lynx rufus              : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 1 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Sylvilagus floridanus   : num [1:67, 1:19] 1 NA 0 0 1 0 0 0 1 1 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Urocyon cinereoargenteus: num [1:67, 1:19] 1 NA 0 0 1 0 0 0 1 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Canis latrans           : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 1 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Mephitis macroura       : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Odocoileus virginianus  : num [1:67, 1:19] 0 NA 1 0 1 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Canis lupus familiaris  : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Pecari tajacu           : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Roedores                : num [1:67, 1:19] 0 NA 0 0 1 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Dasypus novemcinctus    : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Spilogale angustigrons  : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Bassariscus astutus     : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Procyon lotor           : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Capra hircus            : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Puma yagouaroundi       : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##   ..$ Nasua narica            : num [1:67, 1:19] 0 NA 0 0 0 0 0 0 0 0 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
##  $ siteCovs:'data.frame':	67 obs. of  11 variables:
##   ..$ X           : int [1:67] 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ Station     : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   ..$ Cam         : chr [1:67] "MoultrieA30" "Moultrie" "MoultrieA30" "Primos" ...
##   ..$ ...1        : num [1:67] -1.69 -1.64 -1.59 -1.54 -1.49 ...
##   ..$ Vertcover_50: num [1:67] -0.474 0.652 -0.924 -0.924 -1.151 ...
##   ..$ Dcrops      : num [1:67] 0.677 1.462 2.219 0.46 1.172 ...
##   ..$ MSAVI       : num [1:67] 0.732 -0.867 -0.584 -0.143 0.213 ...
##   ..$ Slope       : num [1:67] -0.2196 -0.9927 -1.0259 1.4184 -0.0597 ...
##   ..$ Cluster     : num [1:67] -1.06 -1.06 -1.06 -1.06 -1.06 ...
##   ..$ Effort      : num [1:67] -0.2081 -1.4605 -0.0719 -0.8888 -0.0719 ...
##   ..$ Dpop_G      : num [1:67] -0.4261 -0.3167 -0.1805 -0.1923 -0.0948 ...
##  $ obsCovs :List of 1
##   ..$ effort: num [1:67, 1:19] 0.0626 NA 0.0626 0.0626 0.0626 ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:67] "C1T2P1" "C1T2P11" "C1T2P21" "C1T4P1" ...
##   .. .. ..$ : chr [1:19] "o1" "o2" "o3" "o4" ...
```

---
## Creando el modelo

CamtrapR permite ajustar modelos multi-especie en JAGS y Nimble (es decir en lenguaje BUGS), nosotros vamos a usar JAGS ya que la versi칩n de Nimble aun no permite estimar par치metro N de riqueza de especies


```r
# Usaremos la funci칩n ` communityModel`

# Generemos el modelo
comu_model &lt;- communityModel(data_list, # la lista de datos
                             occuCovs = list(ranef = "Dcrops"), # La covariables de sitio
                             detCovsObservation = list(fixed = "effort"), #Covariables de observaci칩n
                             intercepts = list(det = "ranef", occu = "ranef"),
                             augmentation = c(full = 30),# N칰mero aumentado de especies
                             modelFile = "multmod")# Guardamos la especificaci칩n en un archivo

summary(comu_model)
```

```
## commOccu object (for JAGS)
## 
## 30 species,  67 stations,  19 occasions
## 758 occasions with effort
## Number of detections (by species): 0 - 146 
## 
## Available site covariates:
##  X, Station, Cam, ...1, Vertcover_50, Dcrops, MSAVI, Slope, Cluster, Effort, Dpop_G 
## 
## Used site covariates:
##  Dcrops 
## 
## Available site-occasion covariates:
##  effort
```


---

## Hora de correr el modelo

En este caso no corran la funci칩n porque dura alrededor de 56 min


```r
fit.commu &lt;- fit(comu_model,
                 n.iter = 22000, 
                 n.burnin = 2000,
                 thin = 2,
                 chains = 3,
                 cores = 3,
                 quiet = T
);beep(sound = 4)

# Duraci칩n 56 min aprox
```



---
## Nuestro resultado


```r
modresult &lt;- summary(fit.commu)[["statistics"]]
DT::datatable(round(modresult, 3))
```

<div id="htmlwidget-924877444205561350be" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-924877444205561350be">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Bpvalue_species[20]","Bpvalue_species[21]","Bpvalue_species[22]","Bpvalue_species[23]","Bpvalue_species[24]","Bpvalue_species[25]","Bpvalue_species[26]","Bpvalue_species[27]","Bpvalue_species[28]","Bpvalue_species[29]","Bpvalue_species[30]","Nspecies","Ntotal","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R2[20]","R2[21]","R2[22]","R2[23]","R2[24]","R2[25]","R2[26]","R2[27]","R2[28]","R2[29]","R2[30]","R3","alpha.obs.fixed.cont.effort","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0[20]","alpha0[21]","alpha0[22]","alpha0[23]","alpha0[24]","alpha0[25]","alpha0[26]","alpha0[27]","alpha0[28]","alpha0[29]","alpha0[30]","alpha0.mean","alpha0.sigma","beta.ranef.cont.Dcrops[1]","beta.ranef.cont.Dcrops[2]","beta.ranef.cont.Dcrops[3]","beta.ranef.cont.Dcrops[4]","beta.ranef.cont.Dcrops[5]","beta.ranef.cont.Dcrops[6]","beta.ranef.cont.Dcrops[7]","beta.ranef.cont.Dcrops[8]","beta.ranef.cont.Dcrops[9]","beta.ranef.cont.Dcrops[10]","beta.ranef.cont.Dcrops[11]","beta.ranef.cont.Dcrops[12]","beta.ranef.cont.Dcrops[13]","beta.ranef.cont.Dcrops[14]","beta.ranef.cont.Dcrops[15]","beta.ranef.cont.Dcrops[16]","beta.ranef.cont.Dcrops[17]","beta.ranef.cont.Dcrops[18]","beta.ranef.cont.Dcrops[19]","beta.ranef.cont.Dcrops[20]","beta.ranef.cont.Dcrops[21]","beta.ranef.cont.Dcrops[22]","beta.ranef.cont.Dcrops[23]","beta.ranef.cont.Dcrops[24]","beta.ranef.cont.Dcrops[25]","beta.ranef.cont.Dcrops[26]","beta.ranef.cont.Dcrops[27]","beta.ranef.cont.Dcrops[28]","beta.ranef.cont.Dcrops[29]","beta.ranef.cont.Dcrops[30]","beta.ranef.cont.Dcrops.mean","beta.ranef.cont.Dcrops.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0[20]","beta0[21]","beta0[22]","beta0[23]","beta0[24]","beta0[25]","beta0[26]","beta0[27]","beta0[28]","beta0[29]","beta0[30]","beta0.mean","beta0.sigma","n0","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R2[20]","new.R2[21]","new.R2[22]","new.R2[23]","new.R2[24]","new.R2[25]","new.R2[26]","new.R2[27]","new.R2[28]","new.R2[29]","new.R2[30]","new.R3","omega","w[1]","w[2]","w[3]","w[4]","w[5]","w[6]","w[7]","w[8]","w[9]","w[10]","w[11]","w[12]","w[13]","w[14]","w[15]","w[16]","w[17]","w[18]","w[19]","w[20]","w[21]","w[22]","w[23]","w[24]","w[25]","w[26]","w[27]","w[28]","w[29]","w[30]"],[1,0.716,0.612,1,0.983,0.565,0.721,0.965,0.436,0.819,0.941,0.394,0.459,0.475,0.555,0.562,0.565,0.743,0.027,0.029,0.029,0.029,0.03,0.029,0.028,0.026,0.028,0.03,0.028,0.027,0.031,17.877,19.961,12.388,15.208,23.642,16.386,2.97,6.204,21.548,3.161,14.848,3.804,1.131,2.661,1.845,3.763,3.427,1.668,1.99,0.069,0.071,0.068,0.074,0.075,0.069,0.075,0.066,0.073,0.072,0.07,0.067,0.079,137.573,0.5,-1.683,-2.193,-0.608,-1.025,-2.437,-2.263,-1.129,-2.922,-1.89,-0.736,-2.88,-1.997,-2.941,-2.282,-1.945,-2.413,-2.403,-2.12,-2.123,-2.116,-2.124,-2.126,-2.109,-2.135,-2.123,-2.125,-2.116,-2.114,-2.127,-2.139,-2.042,0.934,-0.186,-0.085,0.215,-0.014,0.122,-0.098,-0.201,0.27,-0.157,-0.126,-0.028,-0.08,-0.314,-0.793,-0.22,-0.22,-0.418,-0.13,-0.126,-0.128,-0.129,-0.134,-0.128,-0.127,-0.132,-0.134,-0.128,-0.132,-0.135,-0.122,-0.134,0.406,-0.353,0.027,-0.099,-0.11,-2.271,-1.592,0.884,-1.947,-0.294,-2.189,-3.163,-2.255,-2.661,-2.212,-2.113,-2.967,-3.046,-2.469,-2.476,-2.524,-2.476,-2.506,-2.506,-2.495,-2.468,-2.483,-2.48,-2.456,-2.496,-2.435,-1.941,1.738,2.961,9.972,13.985,6.232,8.143,2.718,4.879,12.631,3.313,11.106,1.459,1.092,2.683,1.791,3.509,3.076,1.459,1.429,0.047,0.048,0.045,0.052,0.051,0.044,0.054,0.045,0.053,0.047,0.047,0.045,0.056,90.11,0.655,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0.228,0.23,0.227,0.229,0.234,0.228,0.232,0.224,0.227,0.225,0.223,0.226,0.229],[0,0.451,0.487,0,0.131,0.496,0.449,0.185,0.496,0.385,0.236,0.489,0.498,0.499,0.497,0.496,0.496,0.437,0.161,0.168,0.167,0.168,0.172,0.169,0.166,0.16,0.164,0.171,0.165,0.163,0.172,1.133,2.953,4.015,4.963,2.167,2.936,2.084,2.79,4.039,2.064,4.231,1.172,1.166,2.214,1.475,2.245,2.348,1.547,1.497,0.339,0.347,0.341,0.357,0.353,0.334,0.36,0.331,0.354,0.346,0.347,0.331,0.368,12.071,0.094,0.176,0.224,0.113,0.128,0.563,0.371,0.106,0.735,0.194,0.235,0.995,0.416,0.85,0.389,0.409,0.617,0.603,1.095,1.096,1.092,1.103,1.109,1.089,1.11,1.094,1.09,1.097,1.094,1.105,1.113,0.335,0.315,0.234,0.268,0.227,0.216,0.345,0.287,0.238,0.391,0.244,0.289,0.4,0.318,0.387,0.44,0.308,0.367,0.402,0.453,0.453,0.449,0.452,0.447,0.45,0.449,0.453,0.45,0.451,0.453,0.452,0.446,0.148,0.15,0.301,0.434,0.253,0.256,0.657,0.474,0.309,0.879,0.333,0.401,1.183,0.52,0.977,0.593,0.491,0.796,0.816,2.174,2.177,2.199,2.19,2.18,2.191,2.165,2.165,2.185,2.18,2.187,2.193,2.18,0.674,0.548,2.953,3.424,3.814,2.252,2.951,1.6,2.234,3.737,1.734,3.552,1.141,1.08,1.698,1.318,1.886,1.751,1.258,1.263,0.254,0.263,0.249,0.284,0.27,0.242,0.287,0.251,0.289,0.253,0.261,0.246,0.298,10.17,0.123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.419,0.421,0.419,0.42,0.424,0.419,0.422,0.417,0.419,0.417,0.416,0.418,0.42],[0,0.003,0.003,0,0.001,0.003,0.003,0.001,0.003,0.002,0.001,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.007,0.017,0.023,0.029,0.013,0.017,0.012,0.016,0.023,0.012,0.024,0.007,0.007,0.013,0.009,0.013,0.014,0.009,0.009,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.07,0.001,0.001,0.001,0.001,0.001,0.003,0.002,0.001,0.004,0.001,0.001,0.006,0.002,0.005,0.002,0.002,0.004,0.003,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.002,0.002,0.001,0.002,0.001,0.001,0.002,0.002,0.001,0.002,0.001,0.002,0.002,0.002,0.002,0.003,0.002,0.002,0.002,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.001,0.001,0.002,0.003,0.001,0.001,0.004,0.003,0.002,0.005,0.002,0.002,0.007,0.003,0.006,0.003,0.003,0.005,0.005,0.013,0.013,0.013,0.013,0.013,0.013,0.012,0.012,0.013,0.013,0.013,0.013,0.013,0.004,0.003,0.017,0.02,0.022,0.013,0.017,0.009,0.013,0.022,0.01,0.021,0.007,0.006,0.01,0.008,0.011,0.01,0.007,0.007,0.001,0.002,0.001,0.002,0.002,0.001,0.002,0.001,0.002,0.001,0.002,0.001,0.002,0.059,0.001,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002],[0,0.003,0.003,0,0.001,0.004,0.003,0.001,0.004,0.002,0.001,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.026,0.082,0.029,0.053,0.013,0.018,0.025,0.027,0.026,0.031,0.034,0.007,0.016,0.02,0.02,0.021,0.021,0.018,0.017,0.004,0.004,0.004,0.005,0.004,0.004,0.005,0.004,0.005,0.004,0.004,0.004,0.005,0.147,0.001,0.001,0.002,0.001,0.001,0.008,0.004,0.001,0.016,0.001,0.002,0.024,0.004,0.018,0.004,0.003,0.008,0.008,0.016,0.015,0.013,0.017,0.015,0.013,0.017,0.014,0.015,0.013,0.017,0.016,0.016,0.008,0.009,0.002,0.002,0.002,0.001,0.003,0.002,0.002,0.005,0.002,0.002,0.003,0.002,0.004,0.007,0.002,0.003,0.004,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.002,0.003,0.002,0.005,0.001,0.002,0.009,0.005,0.002,0.02,0.003,0.002,0.028,0.005,0.02,0.007,0.004,0.011,0.011,0.036,0.036,0.037,0.038,0.036,0.038,0.036,0.037,0.037,0.036,0.037,0.038,0.036,0.017,0.013,0.082,0.021,0.034,0.013,0.017,0.018,0.019,0.022,0.026,0.024,0.007,0.018,0.013,0.019,0.014,0.013,0.013,0.013,0.004,0.004,0.003,0.006,0.005,0.003,0.005,0.004,0.005,0.003,0.004,0.004,0.005,0.119,0.003,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.007,0.007,0.007,0.007,0.007,0.007,0.007,0.007,0.007,0.007,0.007,0.007,0.007]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
### Veamos el resultado gr치fico

.pull-left[

Otra gran ventaja de CamtrapR es que permite gr치ficar de manera muy sencilla la predicci칩n posterior del modelo. Veamos que pasa con la ocupaci칩n de cada especie


```r
plot_effects(comu_model, # El modelo
             fit.commu, # El objeto ajustado
             submodel = "state") # el par치metro de inter칠s
```
]

.pull-right[



```
## $Dcrops
```

&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-42-1.png" width="100%" height="30" /&gt;

]

---

### Ahora los coeficientes


```r
plot_coef(comu_model,
          fit.commu,
          submodel = "state")
```

```
## $Dcrops
```

&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-43-1.png" width="100%" /&gt;


---

### Realizamos el mismo procedimiento para el submodelo de detecci칩n


```r
plot_effects(comu_model,
             fit.commu,
             submodel = "det")
```

```
## $effort
```

&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-44-1.png" width="100%" /&gt;

---

### y sus respectivos coeficientes

```r
plot_coef(comu_model,
          fit.commu,
          submodel = "det")
```

```
## $effort
```

&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-45-1.png" width="100%" /&gt;

---
### Lo que vinimos a buscar fue la riqueza de especies

La riqueza estimada de especies es ~20 sps
.pull-left[

```r
(riqueza_est &lt;- modresult["Ntotal",])
```

```
##           Mean             SD       Naive SE Time-series SE 
##    19.96107056     2.95338837     0.01705054     0.08235277
```


```r
# Veamos el gr치fico de la distribuci칩n posterior
mcmc_areas(fit.commu, # objeto jags
           pars= "Ntotal", # par치metro de inter칠s
           point_est = "mean",
           prob = 0.95) # intervalos de credibilidad
```
]
.pull-right[
&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-48-1.png" width="100%" /&gt;

]
---
### La estimaci칩n no se ve muy bien, hay que verificar los trace plots

# Deber칤a verse como un cesped, muy probablemente necesitamos muchas mas iteraciones para este modelo

```r
mcmc_trace(fit.commu, pars = "Ntotal")
```

&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-49-1.png" width="100%" /&gt;



```r
gd &lt;- as.data.frame(gelman.diag(fit.commu,  multivariate = FALSE)[[1]])
gd["Ntotal",]
```

```
##        Point est. Upper C.I.
## Ntotal   1.001335   1.002693
```

La prueba de Gelman-Rubin debe ser ~1 para considerar que hay buena convergencia. Aunque tenemos un valor bueno para Ntotal, hay varios valores de omega con NA, eso puede estar causando los problemas.


---
class:inverse

# Ajustamos nuestro primer modelo de multi-especie. 

Recordemos que **N** es la riqueza estimada a un **치rea mayor** de nuestro muestreo (치rea que no conocemos)
.pull-left[
### **N** depende de si cumplimos los supuestos del 치rea
- El muestreo es aleatorio. El 치rea de muestreo debe **representar la regi칩n**
- En caso contrario N representa el n칰mero de especies un 치rea hipot칠tica con **las mismas condiciones**
- Si la regi칩n es peque침a, **N** puede ser **sobre-estimada**
]
.pull-right[
### y de las especies
- Datos de **insectos** no sirven para predecir aves
- Predicci칩n a especies que sean **detectados de manera similar** con la metodolog칤a usada.

.footnote[Guillera-Arroita, G, K칠ry, M, Lahoz-Monfort, JJ. Inferring species richness using multispecies occupancy modeling: Estimation performance and interpretation. Ecol Evol. 2019; 9: 780 792. https://doi.org/10.1002/ece3.4821]
]
---
# 쯉er치 mejor que un estimador no-param칠trico?


```r
## 5.1 Riqueza con Chao2----

# Formatear los datos a un vector de frecuencia
inci_Chao &lt;- ylist %&gt;%  # historias de captura
  map(~rowSums(.,na.rm = T)) %&gt;% # sumo las detecciones en cada sitio
  reduce(cbind) %&gt;% # unimos las listas
  t() %&gt;% # trasponer la tabla
  as_tibble() %&gt;% #formato tibble
  mutate_if(is.numeric,~(.&gt;=1)*1) %&gt;%  #como es incidencia, formateo a 1 y 0
  rowSums() %&gt;%  # ahora si la suma de las incidencias en cada sitio
  as_tibble() %&gt;% 
 add_row(value= 67, .before = 1) %&gt;%  # el formato requiere que el primer valor sea el n칰mero de sitios
  as.matrix() # Requiere formato de matriz


# Calcular la riqueza con estimadores no param칠tricos
chao_sp &lt;- ChaoSpecies(inci_Chao, datatype = "incidence_freq")

NIChao &lt;- chao_sp$Species_table[4,c(1,3,4)] # Extraer valores de IChao

Nocu&lt;- mcmc_intervals(fit.commu, pars = "Ntotal", prob = 0.95,prob_outer = 0.99, point_est = "mean")[[1]] %&gt;%  # Extraer valores del bayes plot
  select(m,l,h) %&gt;% # Seleccionar columnas
  rename("Estimate"= m, # Renombrarlas
         "95%Lower"= l,
         "95%Upper"= h)


# Unir en un solo dataframe
Nplotdata &lt;- rbind(IChao=NIChao, DR.mod=Nocu) %&gt;% 
  as.data.frame() %&gt;% 
  rownames_to_column(.)
```

---
# Comparaci칩n

Veamos de manera gr치fica que tanto difieren las estimaciones de la riqueza

.pull-left[


```r
# Gr치fico para comparar la riqueza estimada
plotN &lt;- ggplot(Nplotdata, aes(x=rowname, y= Estimate, col=rowname))+
  geom_point(aes(shape=rowname),size=3)+
  geom_errorbar(aes(ymin= `95%Lower`, ymax= `95%Upper`), width=.3, size=1)+
  labs(x="Estimador de riqueza",y="N칰mero de especies estimado", title = "Diferencia de los estimadores de riqueza")+
  theme_classic()+
  theme(text=element_text(size = 13), plot.title = element_text(hjust= 0.5), legend.position = "none")
```

]

.pull-right[

&lt;img src="multi_sp_GAP_files/figure-html/unnamed-chunk-53-1.png" width="100%" /&gt;


]

---
class: inverse

# Ocupaci칩n multi-specie vs IChao
.pull-left[


![](img/pildoras.jpg)

.footnote[ Tingley, MW, Nadeau, CP, Sandor, ME. Multi-species occupancy models as robust estimators of community richness. Methods Ecol Evol. 2020; 11: 633 642. https://doi.org/10.1111/2041-210X.13378]
]

.pull-right[
Ambos lo hacen muy mal cuando `\(\psi_k\)` es muy **bajo**

- **Chao** siempre estar치 sesgado al valor **m치s bajo de N** por no considerar la detecci칩n (De hecho Chao lo reconoce)
- Los modelos de ocupaci칩n son muy **hambrientos** de datos
- Tienes que saber "**programar**" para ajustar modelos multi-specie 
- Todav칤a hay algunos bmoles con la heterogeneidad y los prior (Guillera-Arroita et al. 2019)
]

---
# Las posibilidades son infinitas
1. Estructura de la diversidad- N칰mero efectivo de especies
![](img/dethill.png)
---
## 1. Estructura de la diversidad- N칰mero efectivo de especies

.pull-left[
C칩mo la presencia o no de leones afecta la riqueza de meso-carn칤voros

&gt;Curveira-Santos Gon칞alo, Sutherland Chris, Tenan Simone, Fern치ndez-Chac칩n lbert, Mann Gareth K. H., Pitman Ross T.and Swanepoel Lourens H. 2021. Mesocarnivore community structuring in the presence of Africa's apex predator. Proc. R. Soc. B.2882020237920202379. http://doi.org/10.1098/rspb.2020.2379

]

.pull-right[ ![](img/hilllion.png)
]
---
# 2. Diversidad funcional y filogen칠tica
.pull-left[
Las consecuencias de no considerar a especies no detectadas en los an치lisis.

&gt; Jarzyna, M. A., &amp; Jetz, W. (2016). Detecting the multiple facets of biodiversity. Trends in ecology &amp; evolution, 31(7), 527-538. https://doi.org/10.1016/j.tree.2016.04.002



Les dejo ejemplos divertidos en la carpeta de bibliograf칤a

]

.pull-right[
![](img/funcional.jpg)
]

---
class: inverse, center, top

background-image: url("img/peca.JPG")
background-position: 60% 60%
background-size: cover


# .big-text[Gracias]

---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightLanguage": ["r", "css"],
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
